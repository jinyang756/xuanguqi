<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>选股器</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/effects.css">
    <script src="js/tushare_api.js"></script>
    <script src="js/stock_selector.js"></script>
    <script src="js/visual_effects.js"></script>
</head>
<body>
    <!-- 菜单栏（折叠式） -->
    <div class="menu-container">
        <button id="menu-toggle" class="menu-toggle" aria-label="打开菜单" aria-expanded="false">
            <span class="menu-icon"></span>
        </button>
        <nav id="collapsible-menu" class="collapsible-menu">
            <ul>
                <li class="menu-item">免费福利</li>
                <li class="menu-item">皓月</li>
                <li class="menu-item">量化指标</li>
                <li class="menu-item">联合机构</li>
                <li class="menu-item">声明</li>
            </ul>
        </nav>
    </div>

    <!-- 首页标题（可选） -->
    <div class="title-container">
        <h1 class="main-title">皓月选股器</h1>
        <p class="main-desc">科技感 · 数据可视化 · 量化选股</p>
    </div>

    <!-- 视觉特效画布 -->
    <canvas id="effect-canvas"></canvas>
    
    <!-- 开始选股按钮 -->
    <button id="start-btn">开始选股</button>
    
    <!-- 结果展示区域 -->
    <div id="result">
        <div class="result-moon"></div>
        <div class="result-title">选股结果</div>
        <div class="result-list"></div>
        <div class="result-footer">数据可视化 · 皓月呼应 · 科技感选股</div>
    </div>

    <script>
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        
        // 初始化音效设置
        let soundEnabled = localStorage.getItem('soundEnabled') === 'true';
        
        // 播放音效
        function playSound(frequency, duration, volume = 0.3) {
            if (!soundEnabled || !audioContext) return;
            
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.value = frequency;
            oscillator.type = 'sine';
            
            gainNode.gain.setValueAtTime(volume, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + duration);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + duration);
        }
        
        // 播放选股流程音效
        function playSelectionSound() {
            playSound(440, 0.5); // A4音符
            setTimeout(() => playSound(554, 0.3), 300); // C#5音符
            setTimeout(() => playSound(659, 0.7), 600); // E5音符
        }
        
        // 播放筛选音效
        function playFilterSound() {
            playSound(330, 0.2); // E4音符
        }
        
        // 播放结果音效
        function playResultSound() {
            playSound(523, 0.8, 0.5); // C5音符
            setTimeout(() => playSound(659, 0.5, 0.4), 400); // E5音符
            setTimeout(() => playSound(784, 1.2, 0.6), 900); // G5音符
        }
        
        // 音效按钮
        document.getElementById('sound-btn').addEventListener('click', () => {
            if (!audioContext) {
                initAudio();
            }
            
            soundEnabled = !soundEnabled;
            localStorage.setItem('soundEnabled', soundEnabled.toString());
            
            const soundIcon = document.querySelector('#sound-btn i');
            
            if (soundEnabled) {
                soundIcon.className = 'fas fa-volume-up';
                playSound(440, 0.3); // 确认音效
            } else {
                soundIcon.className = 'fas fa-volume-mute';
            }
        });
        
        // 在选股流程中添加音效调用
        // 增强startSelection函数
        const originalStartSelection = startSelection;
        startSelection = function() {
            originalStartSelection();
            if (soundEnabled) {
                playSelectionSound();
            }
        };
        
        // 全屏按钮
        document.getElementById('fullscreen-btn').addEventListener('click', () => {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                }
            }
        });
        
        // 重写showResult函数以调整简介显示位置
        const originalShowResult = showResult;
        showResult = function(cube) {
            try {
                originalShowResult(cube);
            } catch (error) {
                if (error instanceof TypeError && error.message.includes('toFixed')) {
                    console.warn('捕获到TypeError异常 - 可能是股票数据中的toFixed()调用出错:', error);
                    // 可以在这里添加更具体的错误处理逻辑
                } else {
                    console.error('showResult函数执行出错:', error);
                }
            }
            
            // 简介区域已移除，不再显示
            // 简介区域已移除，不再执行相关操作
        };
        
        // 窗口大小调整
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
        
        // 初始化折叠菜单
        const menuToggle = document.getElementById('menu-toggle');
        const collapsibleMenu = document.getElementById('collapsible-menu');
        
        menuToggle.addEventListener('click', function() {
            menuToggle.classList.toggle('active');
            collapsibleMenu.classList.toggle('expanded');
            const isExpanded = collapsibleMenu.classList.contains('expanded');
            menuToggle.setAttribute('aria-expanded', isExpanded);
            menuToggle.setAttribute('aria-label', isExpanded ? '关闭菜单' : '打开菜单');
        });
        
        // 创建6个菜单详情模态框
        function createMenuModals() {
            // 免费福利模态框
            const freeBenefitsModal = document.createElement('div');
            freeBenefitsModal.id = 'free-benefits-modal';
            freeBenefitsModal.className = 'modal fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center hidden';
            freeBenefitsModal.innerHTML = `
                <div class="modal-content bg-white/10 backdrop-blur-md p-6 rounded-lg max-w-2xl w-full max-h-[80vh] overflow-y-auto">
                    <div class="modal-header flex justify-between items-center mb-4">
                        <h2 class="text-2xl font-bold text-white">免费福利</h2>
                        <button class="modal-close text-white hover:text-gray-300 text-xl">×</button>
                    </div>
                    <div class="modal-body text-white">
                        <div class="mb-6">
                            <h3 class="text-xl font-semibold mb-3 text-[#00f0ff]">飞书群专属引导</h3>
                            <p class="mb-3">所有福利需进入《日斗投资【第十届财富论坛投资策略会】》飞书群领取，进群步骤：</p>
                            <ol class="list-decimal list-inside space-y-2 pl-4">
                                <li>打开手机应用商城，搜索 "飞书" 下载 APP；</li>
                                <li>用手机号注册并登录；</li>
                                <li>两种进群方式：扫码进群 / 点击链接跳转：</li>
                                <li><button class="join-group-btn bg-[#05ffa1] text-black font-bold py-2 px-4 rounded-md hover:bg-opacity-80 transition-all" onclick="window.open('https://applink.larksuite.com/client/chat/chatter/add_by_link?link_token=b0en0f42-377e-42a2-b77f-4a93f5805651', '_blank')">立即加入飞书群</button></li>
                                <li>权益说明：新用户首次进群可免费体验「皓月 3.0 基础选股功能」，后续高级功能会在群内提供。</li>
                            </ol>
                        </div>
                        
                        <div class="mb-6">
                            <h3 class="text-xl font-semibold mb-3 text-[#00f0ff]">群内配套福利</h3>
                            <div class="space-y-4">
                                <div class="bg-white/5 p-4 rounded-lg">
                                    <h4 class="font-semibold text-[#05ffa1] mb-2">免费量化工具包</h4>
                                    <p>群内定期更新「基础选股组合（每周 1 次）」「7 日行情可视化报告」</p>
                                </div>
                                <div class="bg-white/5 p-4 rounded-lg">
                                    <h4 class="font-semibold text-[#05ffa1] mb-2">投资策略会资源</h4>
                                    <p>同步《第十届财富论坛》直播回放、嘉宾分享的 "量化选股实战案例"</p>
                                </div>
                                <div class="bg-white/5 p-4 rounded-lg">
                                    <h4 class="font-semibold text-[#05ffa1] mb-2">新人专属学习包</h4>
                                    <p>群内领取「量化入门图文课」「零代码策略模板（如北向资金加仓筛选）」</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(freeBenefitsModal);

            // 皓月模态框（合并了原萤火和皓月功能）
            const moonlightModal = document.createElement('div');
            moonlightModal.id = 'moonlight-modal';
            moonlightModal.className = 'modal fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center hidden';
            moonlightModal.innerHTML = `
                <div class="modal-content bg-white/10 backdrop-blur-md p-6 rounded-lg max-w-2xl w-full max-h-[80vh] overflow-y-auto">
                    <div class="modal-header flex justify-between items-center mb-4">
                        <h2 class="text-2xl font-bold text-white">皓月</h2>
                        <button class="modal-close text-white hover:text-gray-300 text-xl">×</button>
                    </div>
                    <div class="modal-body text-white">
                        <div class="mb-6">
                            <h3 class="text-xl font-semibold mb-3 text-[#00f0ff]">产品定位</h3>
                            <p class="mb-3">由专业团队提供核心技术支持的轻量化量化选股工具，融合在 "多因子模型、数据处理、策略回测" 领域的成熟经验，为个人投资者打造 "机构级体验、平民化门槛" 的选股功能。</p>
                        </div>
                        
                        <div class="mb-6">
                            <h3 class="text-xl font-semibold mb-3 text-[#00f0ff]">核心功能</h3>
                            <div class="space-y-4">
                                <div class="bg-white/5 p-4 rounded-lg">
                                    <h4 class="font-semibold text-[#05ffa1] mb-2">专业多因子选股</h4>
                                    <p>沿用classical "估值 + 成长 + 资金 + 情绪"4 大核心维度，升级为 8 大因子体系（含特色的 "高频量价因子"），个股评分与排序逻辑具备专业可靠性。</p>
                                </div>
                                <div class="bg-white/5 p-4 rounded-lg">
                                    <h4 class="font-semibold text-[#05ffa1] mb-2">实时行情联动</h4>
                                    <p>对接专业的机构级行情数据源，选股结果同步显示「分时图、主力资金流向、盘口异动」，数据延迟≤3 秒。</p>
                                </div>
                                <div class="bg-white/5 p-4 rounded-lg">
                                    <h4 class="font-semibold text-[#05ffa1] mb-2">极简策略回测</h4>
                                    <p>基于专业历史回测框架，支持可视化调整参数（如因子权重、持有周期），一键生成「历史收益率、最大回撤、胜率」报告，回测基准默认对标 "沪深 300 指数"。</p>
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <h3 class="text-xl font-semibold mb-3 text-[#00f0ff]">3.0 升级亮点</h3>
                            <p>引入专业的 "AI 情绪因子"（融合舆情分析、资金热度模型），选股精准度较 2.0 提升 23%；界面响应速度优化采用专业轻量化数据处理方案，流畅度提升 40%。</p>
                        </div>
                    </div>
                </div>
            `;


            // 皓月高级功能说明（原皓月模块内容）
            moonlightModal.id = 'moonlight-modal';
            moonlightModal.className = 'modal fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center hidden';
            moonlightModal.innerHTML = `
                <div class="modal-content bg-white/10 backdrop-blur-md p-6 rounded-lg max-w-2xl w-full max-h-[80vh] overflow-y-auto">
                    <div class="modal-header flex justify-between items-center mb-4">
                        <h2 class="text-2xl font-bold text-white">皓月</h2>
                        <button class="modal-close text-white hover:text-gray-300 text-xl">×</button>
                    </div>
                    <div class="modal-body text-white">
                        <div class="mb-6">
                            <h3 class="text-xl font-semibold mb-3 text-[#00f0ff]">服务定位</h3>
                            <p class="mb-3">皓月 3.0」的高端隐藏模块，是日斗投资、主观量化等联合机构共同打造的 "进阶工具包"，不对外公开功能详情，仅面向飞书群用户开放体验资格。</p>
                        </div>
                        
                        <div class="mb-6">
                            <h3 class="text-xl font-semibold mb-3 text-[#00f0ff]">群内体验权益</h3>
                            <div class="space-y-4">
                                <div class="bg-white/5 p-4 rounded-lg">
                                    <h4 class="font-semibold text-[#05ffa1] mb-2">每周 1 次「皓月专属策略推送」</h4>
                                    <p>由专业团队提供的 "中高级选股策略"（如行业轮动、事件驱动策略），仅群内用户可查看策略逻辑与标的。</p>
                                </div>
                                <div class="bg-white/5 p-4 rounded-lg">
                                    <h4 class="font-semibold text-[#05ffa1] mb-2">每月 2 次「机构级数据体验」</h4>
                                    <p>开放专业团队的 "全量研报、机构持仓明细、行业高频数据"（数据维度是基础功能的 3 倍），仅支持在群内查看，不可下载。</p>
                                </div>
                                <div class="bg-white/5 p-4 rounded-lg">
                                    <h4 class="font-semibold text-[#05ffa1] mb-2">专属顾问对接</h4>
                                    <p>体验期间可预约专业团队的量化顾问，1 对 1 解答 "策略优化、因子调整" 疑问。</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(moonlightModal);

            // 量化指标模态框
            const quantIndicatorsModal = document.createElement('div');
            quantIndicatorsModal.id = 'quant-indicators-modal';
            quantIndicatorsModal.className = 'modal fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center hidden';
            quantIndicatorsModal.innerHTML = `
                <div class="modal-content bg-white/10 backdrop-blur-md p-6 rounded-lg max-w-2xl w-full max-h-[80vh] overflow-y-auto">
                    <div class="modal-header flex justify-between items-center mb-4">
                        <h2 class="text-2xl font-bold text-white">量化指标</h2>
                        <button class="modal-close text-white hover:text-gray-300 text-xl">×</button>
                    </div>
                    <div class="modal-body text-white">
                        <div class="mb-6">
                            <h3 class="text-xl font-semibold mb-3 text-[#00f0ff]">指标体系</h3>
                            <p class="mb-3">「核心因子分类」：基础因子（PE、PB、营收增速等）沿用行业标准，特色因子（如 "高频量价因子""AI 情绪因子"）源自专业技术体系，"价值因子" 参考成熟的价值投资逻辑。</p>
                            <p class="mb-3">「因子计算逻辑」：以 "多因子模型" 为例，公开各因子权重（如 "高频量价因子占比 25%""成长因子占比 30%"），数据标准化方式采用专业标准。</p>
                        </div>
                        
                        <div class="mb-6">
                            <h3 class="text-xl font-semibold mb-3 text-[#00f0ff]">模型透明度</h3>
                            <p>公开「专业团队共同认证的回测报告」，展示近 3 年 "选股组合 vs 沪深 300 指数" 的超额收益曲线，回测数据由专业团队验证，确保真实性。</p>
                        </div>
                        
                        <div>
                            <h3 class="text-xl font-semibold mb-3 text-[#00f0ff]">工具辅助</h3>
                            <p>提供「指标自定义计算器」，输入个股代码可查看「个股在各因子的得分、行业排名」，排名数据源自联合机构共享的 "全市场因子数据库"。</p>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(quantIndicatorsModal);

            // 联合机构模态框
            const partnerInstitutionsModal = document.createElement('div');
            partnerInstitutionsModal.id = 'partner-institutions-modal';
            partnerInstitutionsModal.className = 'modal fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center hidden';
            partnerInstitutionsModal.innerHTML = `
                <div class="modal-content bg-white/10 backdrop-blur-md p-6 rounded-lg max-w-2xl w-full max-h-[80vh] overflow-y-auto">
                    <div class="modal-header flex justify-between items-center mb-4">
                        <h2 class="text-2xl font-bold text-white">联合机构</h2>
                        <button class="modal-close text-white hover:text-gray-300 text-xl">×</button>
                    </div>
                    <div class="modal-body text-white">
                        <div class="mb-6">
                            <h3 class="text-xl font-semibold mb-3 text-[#00f0ff]">合作机构名单及价值</h3>
                            <div class="space-y-4">

                                <div class="bg-white/5 p-4 rounded-lg">
                                    <h4 class="font-semibold text-[#05ffa1] mb-1">日斗投资</h4>
                                    <p>资源整合方，牵头《第十届财富论坛投资策略会》，负责飞书群运营与福利落地，提供 "策略会直播、嘉宾资源"。</p>
                                </div>

                                <div class="bg-white/5 p-4 rounded-lg">
                                    <h4 class="font-semibold text-[#05ffa1] mb-1">聚财众发</h4>
                                    <p>数据合作方，提供 "机构持仓明细、行业高频数据"，支撑 "皓月" 模块的进阶数据需求。</p>
                                </div>

                            </div>
                        </div>
                        
                        <div class="mb-6">
                            <h3 class="text-xl font-semibold mb-3 text-[#00f0ff]">合作形式</h3>
                            <ul class="list-disc list-inside space-y-2 pl-4">
                                <li>「技术合作」：与专业技术团队联合开发 "多因子模型""AI 情绪因子"</li>
                                <li>「资源合作」：与日斗投资联合运营飞书群，同步《财富论坛》资源；共享机构级数据</li>
                                <li>「策略共创」：与专业团队联合研发 "皓月" 模块的中高级策略</li>
                            </ul>
                        </div>
                        
                        <div>
                            <h3 class="text-xl font-semibold mb-3 text-[#00f0ff]">机构背书</h3>
                            <div class="space-y-4">

                                <div class="bg-white/5 p-4 rounded-lg italic">
                                    <p>日斗投资 CEO："《第十届财富论坛》的核心策略资源已同步至飞书群，结合'皓月'工具，能为用户提供'策略 + 工具'的一站式服务。"</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(partnerInstitutionsModal);

            // 声明模态框
            const statementModal = document.createElement('div');
            statementModal.id = 'statement-modal';
            statementModal.className = 'modal fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center hidden';
            statementModal.innerHTML = `
                <div class="modal-content bg-white/10 backdrop-blur-md p-6 rounded-lg max-w-2xl w-full max-h-[80vh] overflow-y-auto">
                    <div class="modal-header flex justify-between items-center mb-4">
                        <h2 class="text-2xl font-bold text-white">声明</h2>
                        <button class="modal-close text-white hover:text-gray-300 text-xl">×</button>
                    </div>
                    <div class="modal-body text-white">
                        <div class="mb-6">
                            <h3 class="text-xl font-semibold mb-3 text-[#00f0ff]">风险提示</h3>
                            <p class="mb-3">量化选股基于历史数据与专业模型算法，不构成投资建议；股市有风险，投资需谨慎；"皓月"模块的过往表现不代表未来收益，用户应结合自身风险承受能力决策；飞书群内分享的策略与数据仅作参考，不可作为实盘操作唯一依据。</p>
                        </div>
                        
                        <div class="mb-6">
                            <h3 class="text-xl font-semibold mb-3 text-[#00f0ff]">版权说明</h3>
                            <p class="mb-3">"量化选股器"软件、数据（含专业团队提供的因子模型、行情数据）、图文内容，知识产权归我司及合作团队共同所有，未经授权禁止转载、商用；飞书群内资源（如直播回放、策略报告）仅限群内用户个人使用，禁止转发。</p>
                        </div>
                        
                        <div class="mb-6">
                            <h3 class="text-xl font-semibold mb-3 text-[#00f0ff]">免责条款</h3>
                            <p>因不可抗力（如服务器故障、行情源异常）或数据更新延迟导致的选股偏差，我司及合作团队不承担赔偿责任；用户需理解量化工具的局限性，不可过度依赖。</p>
                        </div>
                        
                        <div>
                            <h3 class="text-xl font-semibold mb-3 text-[#00f0ff]">隐私政策</h3>
                            <p>严格保护用户个人信息，不向第三方泄露；如需使用用户数据优化模型，会提前通过飞书群征求用户同意。</p>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(statementModal);

            // 模态框已经在后面统一添加了关闭事件监听器，这里不再重复添加
        }

        // 初始化菜单模态框
            createMenuModals();
            
            // 添加加入群组按钮的样式
            const style = document.createElement('style');
            style.textContent = `
                .join-group-btn {
                    margin: 10px 0;
                    transition: all 0.3s ease;
                    box-shadow: 0 0 15px rgba(5, 255, 161, 0.5);
                }
                .join-group-btn:hover {
                    transform: translateY(-2px);
                    box-shadow: 0 0 25px rgba(5, 255, 161, 0.8);
                }
            `;
            document.head.appendChild(style);

        // 菜单点击事件
        const menuItems = document.querySelectorAll('.menu-item');
        menuItems.forEach(item => {
            item.addEventListener('click', function() {
                // 关闭菜单
                menuToggle.classList.remove('active');
                collapsibleMenu.classList.remove('expanded');
                
                // 隐藏首页标题
                document.querySelector('.title-container').classList.add('title-hidden');
                
                // 根据菜单项显示对应的模态框
                const menuText = this.textContent.trim();
                console.log('Menu item clicked:', menuText);
                
                // 先隐藏所有模态框
                document.querySelectorAll('.modal').forEach(modal => {
                    modal.classList.add('hidden');
                    modal.style.display = 'none';
                });
                
                // 显示对应模态框
                switch (menuText) {
                    case '免费福利':
                        const freeBenefitsModal = document.getElementById('free-benefits-modal');
                        freeBenefitsModal.classList.remove('hidden');
                        freeBenefitsModal.style.display = 'flex';
                        break;

                    case '皓月':
                        const moonlightModal = document.getElementById('moonlight-modal');
                        moonlightModal.classList.remove('hidden');
                        moonlightModal.style.display = 'flex';
                        break;
                    case '量化指标':
                        const quantIndicatorsModal = document.getElementById('quant-indicators-modal');
                        quantIndicatorsModal.classList.remove('hidden');
                        quantIndicatorsModal.style.display = 'flex';
                        break;
                    case '联合机构':
                        const partnerInstitutionsModal = document.getElementById('partner-institutions-modal');
                        partnerInstitutionsModal.classList.remove('hidden');
                        partnerInstitutionsModal.style.display = 'flex';
                        break;
                    case '声明':
                        const statementModal = document.getElementById('statement-modal');
                        statementModal.classList.remove('hidden');
                        statementModal.style.display = 'flex';
                        break;
                }
            });
        });
        
        // 点击页面其他地方关闭菜单
        document.addEventListener('click', function(event) {
            if (!menuToggle.contains(event.target) && 
                !collapsibleMenu.contains(event.target) && 
                collapsibleMenu.classList.contains('expanded')) {
                menuToggle.classList.remove('active');
                collapsibleMenu.classList.remove('expanded');
            }
        });
        
        // 等待DOM加载完成后再添加模态框事件监听器
        setTimeout(() => {
            // 为所有模态框关闭按钮添加事件监听器
            document.querySelectorAll('.modal-close').forEach(closeBtn => {
                closeBtn.addEventListener('click', function() {
                    const modal = this.closest('.modal');
                    modal.classList.add('hidden');
                    modal.style.display = 'none';
                    
                    // 显示首页标题
                    document.querySelector('.title-container').classList.remove('title-hidden');
                });
            });
            
            // 点击模态框背景关闭模态框
            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('click', function(event) {
                    if (event.target === this) {
                        this.classList.add('hidden');
                        this.style.display = 'none';
                        
                        // 显示首页标题
                        document.querySelector('.title-container').classList.remove('title-hidden');
                    }
                });
            });
        }, 100);
        
        // 测试函数：允许通过控制台直接测试声明模态框
        window.testStatementModal = function() {
            console.log('Testing statement modal...');
            const statementModal = document.getElementById('statement-modal');
            if (statementModal) {
                console.log('Statement modal found:', statementModal);
                
                // 先隐藏所有模态框
                document.querySelectorAll('.modal').forEach(modal => {
                    modal.classList.add('hidden');
                    modal.style.display = 'none';
                });
                
                // 隐藏首页标题
                document.querySelector('.title-container').classList.add('title-hidden');
                
                // 显示声明模态框
                statementModal.classList.remove('hidden');
                statementModal.style.display = 'flex';
                console.log('Statement modal should be visible now');
            } else {
                console.error('Statement modal not found!');
            }
        };
        
        // 动画循环
        function animate() {
            requestAnimationFrame(animate);
            
            // 粒子系统动画
            if (particlesSystem) {
                particlesSystem.rotation.x += 0.001;
                particlesSystem.rotation.y += 0.001;
            }
            
            renderer.render(scene, camera);
        }
        
        animate();
    </script>
</body>
</html>