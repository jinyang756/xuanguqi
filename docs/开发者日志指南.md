# 选股器项目开发者日志指南

## 项目概述

本项目是一个基于多因子模型的量化选股工具，支持股票数据分析、筛选和可视化展示。项目提供了前端界面和后端脚本两种使用方式，能够从多种数据源获取和处理股票数据。

## 开发历程

### 初始开发阶段

1. **项目架构设计**
   - 设计了前端（HTML/CSS/JavaScript）和后端（Python）分离的架构
   - 创建了模块化的数据处理和选股逻辑
   - 设计了数据存储结构（原始数据和处理后数据分离）

2. **核心功能实现**
   - 开发了通达信.day文件解析功能（`parse_day_files.py`）
   - 实现了多因子选股算法（`select_stock.py`）
   - 构建了前端可视化界面（`index.html`, `stock_selector.js`）

### 数据集成阶段

1. **数据源扩展**
   - 集成了Tushare API数据源（`tushare_integration.py`）
   - 开发了免费数据源爬虫（`free_stock_data.py`）
   - 实现了数据整合功能（`integrate_stock_data.py`, `process_tushare_data.py`）

2. **数据处理优化**
   - 开发了多个数据解析脚本（`parse_stock_data.py`, `parse_all_data.py`）
   - 实现了数据编码修复功能（`fix_encoding.py`, `count_stocks.py`）

### 功能完善阶段

1. **A股数据过滤**
   - 开发了A股数据过滤工具（`filter_a_stocks.py`）
   - 实现了A股数据编码修复功能（`fix_encoding.py`）
   - 创建了A股数据过滤说明文档

2. **用户体验优化**
   - 开发了简化的运行入口（`run_stock_selector.py`）
   - 实现了测试脚本（`test_stock_selection.py`）
   - 创建了详细的使用文档

## 数据处理报告

### 数据处理概述

本报告总结了对 `data/original/lday` 目录下所有 `.day` 文件的解析和处理结果。处理过程包括文件解析、数据提取、编码修复和统计分析。

### 数据解析情况

- **解析文件总数**: 8737 个 `.day` 文件
- **成功解析数据**: 8737 条股票数据
- **解析完成时间**: 2025-09-23 15:56:09
- **编码修复完成时间**: 2025-09-23 15:57:50

### 数据内容说明

每个解析后的数据记录包含以下字段：
- **code**: 股票代码（带市场标识，如 600519.SH）
- **name**: 股票名称
- **price**: 最新价格
- **priceChange**: 价格变动
- **changePercent**: 涨跌幅百分比
- **volume**: 成交量（手）
- **amount**: 成交额（元）
- **industry**: 所属行业
- **date**: 数据日期

### 行业分布统计

| 行业       | 股票数量 | 占比   |
|------------|----------|--------|
| 未知行业   | 5639     | 64.5%  |
| 房地产     | 1407     | 16.1%  |
| ETF        | 1185     | 13.6%  |
| 债券       | 214      | 2.4%   |
| 基金       | 167      | 1.9%   |
| 银行       | 110      | 1.3%   |
| 电子元件   | 3        | 0.0%   |
| 酿酒行业   | 2        | 0.0%   |
| 医药制造   | 2        | 0.0%   |
| 家电行业   | 1        | 0.0%   |
| 电力行业   | 1        | 0.0%   |
| 保险       | 1        | 0.0%   |
| 旅游酒店   | 1        | 0.0%   |
| 证券       | 1        | 0.0%   |
| 煤炭采选   | 1        | 0.0%   |
| 食品饮料   | 1        | 0.0%   |
| 汽车行业   | 1        | 0.0%   |

### 处理后文件说明

处理完成后生成的文件：

1. **data/processed/stock_data.json**
   - 原始解析结果（可能存在中文显示问题）

2. **data/processed/stock_data_fixed.json**
   - 编码修复后的完整数据文件
   - 中文字符已正确显示
   - 可直接用于数据分析和展示

3. **data/processed/stock_data_log.txt**
   - 原始解析日志

4. **data/processed/stock_data_fixed_log.txt**
   - 编码修复后的详细日志

### 数据样本

以下是部分成功解析的股票数据示例：

| 代码       | 名称     | 价格  | 行业     |
|------------|----------|-------|----------|
| 600519.SH  | 贵州茅台 | 145.34| 酿酒行业 |
| 000858.SZ  | 五粮液   | 12.25 | 酿酒行业 |
| 000333.SZ  | 美的集团 | 7.33  | 家电行业 |
| 000651.SZ  | 000651.SZ| 3.98  | 未知行业 |

### 后续建议

1. **行业信息完善**
   - 当前有 64.5% 的股票行业信息为"未知行业"
   - 建议通过额外数据源补充完整的行业分类信息

2. **数据字段扩展**
   - 目前部分字段（如市盈率、净资产收益率、市值等）暂时设为0
   - 可以考虑从其他数据源获取这些信息

3. **数据定期更新**
   - 建议定期运行解析脚本，更新最新的股票数据

4. **数据可视化**
   - 可以基于处理后的数据创建图表，展示市场概况和行业分布

5. **数据质量检查**
   - 建议对解析后的数据进行进一步的质量检查和清洗

---

**生成时间**: 2025-09-23 15:58:30

## 数据情况说明

### 当前数据状态

经过对项目代码和数据的分析，发现当前系统中整合的股票数据仅包含**10只股票**，具体如下：

| 股票代码 | 股票名称 | 所属行业 |
|---------|---------|---------|
| 600519.SH | 贵州茅台 | 酿酒行业 |
| 000858.SZ | 五粮液 | 酿酒行业 |
| 000333.SZ | 美的集团 | 家电行业 |
| 000651.SZ | 格力电器 | 家电行业 |
| 002415.SZ | 海康威视 | 电子元件 |
| 600900.SH | 长江电力 | 电力行业 |
| 601318.SH | 中国平安 | 保险行业 |
| 601888.SH | 中国中免 | 旅游酒店 |
| 600276.SH | 恒瑞医药 | 医药制造 |
| 000001.SZ | 平安银行 | 银行行业 |

### 数据来源分析

根据对代码的分析，项目的数据获取和整合机制如下：

1. **Tushare API调用**
   - `tushare_basic_data.py`脚本尝试通过Tushare API获取主板上市股票列表
   - 当API调用失败时，系统会自动使用预定义的`DEFAULT_STOCKS`列表（仅包含10只股票）
   - 当前系统似乎使用了默认股票列表，而没有成功获取完整的A股数据

2. **免费数据源**
   - `free_stock_data.py`脚本从新浪财经和东方财富网等免费数据源获取补充信息
   - 目前主要只获取行业分类信息，大部分财务指标（如PE、PB、ROE）为默认值0
   - 免费数据源的获取受限于网站结构变化和访问频率限制

3. **数据整合过程**
   - `integrate_stock_data.py`整合来自Tushare和免费数据源的数据
   - 最终整合结果保存在`stock_data.json`文件中，用于前端展示

### 数据限制原因

当前系统只包含10只股票数据的主要原因是：

1. **Tushare API访问限制**：
   - Tushare API有访问频率和积分限制
   - 当前使用的是零积分接口，功能有限
   - 系统在API调用失败时自动切换到默认股票列表

2. **免费数据源的局限性**：
   - 从网页抓取数据受限于网站结构变化
   - 频繁请求可能导致IP被封
   - 目前只实现了基础的行业信息获取

3. **数据获取流程未完整执行**：
   - 可能缺少完整运行数据更新脚本的步骤
   - 没有创建自动更新数据的批处理文件

### 如何获取完整的A股市场数据

要获取完整的A股市场数据，需要执行以下步骤：

#### 1. 确保Tushare API可正常使用

```python
# 修改tushare_basic_data.py中的TOKEN（如果需要）
TOKEN = 'e4f693ec67d80ef11b6fd446007110cd95bbf82508b7a7758e4f6fad'
```

#### 2. 按顺序运行数据更新脚本

1. 首先运行Tushare基础数据获取脚本：
   ```bash
   python scripts/tushare_basic_data.py
   ```

2. 然后运行免费数据源补充脚本：
   ```bash
   python scripts/free_stock_data.py
   ```

3. 最后运行数据整合脚本：
   ```bash
   python scripts/integrate_stock_data.py
   ```

#### 3. 创建自动更新批处理文件

创建一个`更新股票数据.bat`文件，内容如下：

```batch
@echo off
cd /d %~dp0

:: 运行Tushare基础数据获取脚本
python tushare_basic_data.py
if %errorlevel% neq 0 goto error

:: 运行免费数据源补充脚本
python free_stock_data.py
if %errorlevel% neq 0 goto error

:: 运行数据整合脚本
python integrate_stock_data.py
if %errorlevel% neq 0 goto error

echo 所有数据更新完成！
pause
exit /b 0

:error
echo 数据更新过程中出现错误！
pause
exit /b 1
```

#### 4. 考虑使用付费数据接口

如果需要更稳定、更完整的数据，可以考虑：
- 升级Tushare账户获取更多API权限
- 使用其他专业的金融数据服务
- 考虑订阅商业数据接口

### 数据更新频率建议

为了保持数据的及时性，建议：
- 每日收盘后更新股票价格和交易数据
- 每季度更新财务指标数据
- 定期检查数据源网站结构是否有变化

### 后续改进方向

1. **优化数据获取机制**：
   - 增加API调用重试机制
   - 实现更智能的数据源切换策略
   - 添加数据缓存功能减少重复请求

2. **丰富数据内容**：
   - 完善从免费数据源获取财务指标的功能
   - 增加更多技术指标和基本面数据
   - 实现数据质量检查和清洗功能

3. **自动化数据更新**：
   - 设置定时任务自动更新数据
   - 添加更新日志记录
   - 实现数据更新状态监控

通过以上改进，可以逐步构建一个包含完整A股市场数据的选股系统，为股票分析和投资决策提供更全面的数据支持。

## A股数据过滤说明

### 项目背景

为了提高选股器的分析准确性，我们对原始数据进行了A股股票的筛选，移除了ETF、基金、指数等非A股股票数据，确保选股分析仅基于纯粹的A股股票。

### 过滤过程

#### 1. 过滤工具开发

开发了`filter_a_stocks.py`脚本，通过以下规则进行A股股票的筛选：

- **保留条件**：符合A股代码格式的股票
  - 沪市主板/科创板：600xxx.SH、601xxx.SH、603xxx.SH
  - 深市主板/中小板：000xxx.SZ、001xxx.SZ、002xxx.SZ
  - 深市创业板：300xxx.SZ

- **排除条件**：
  - 名称与代码相同的股票（通常为非A股）
  - 行业包含特定关键词的股票（ETF、指数、基金、债券等）

#### 2. 数据处理结果

从原始的8737条股票数据中，成功筛选出20条纯粹的A股股票数据，主要包括：

| 股票代码    | 股票名称   | 所属行业   | 价格(元) |
|---------|--------|--------|------|
| 600519.SH | 贵州茅台   | 酿酒行业   | 145.34 |
| 000858.SZ | 五粮液    | 酿酒行业   | 12.25 |
| 000333.SZ | 美的集团   | 家电行业   | 7.33 |
| 002415.SZ | 海康威视   | 电子元件   | 3.04 |
| 600900.SH | 长江电力   | 电力行业   | 2.71 |
| 000725.SZ | 京东方A   | 电子元件   | 0.41 |

（完整列表请查看`data/processed/stock_data_a_shares_fixed.json`文件）

#### 3. 编码修复

由于Windows命令行环境的编码问题，过滤后的A股数据出现了中文乱码。为此开发了`fix_encoding.py`脚本（合并了原`fix_a_shares_encoding.py`的功能），修复了以下文件的编码问题：

- `stock_data_a_shares.json` -> `stock_data_a_shares_fixed.json`（A股数据文件）
- `stock_data_a_shares_filter_report.txt` -> `stock_data_a_shares_filter_report_fixed.txt`（过滤报告）

### 选股器更新

已更新`backend/select_stock.py`文件，使其优先使用过滤后的A股数据文件进行选股分析：

1. 首先尝试加载`stock_data_a_shares_fixed.json`（过滤后的A股数据）
2. 如果A股数据文件不存在，则尝试使用`stock_data_fixed.json`（修复了编码的完整数据）
3. 最后才会尝试使用原始数据文件

### 验证结果

运行`run_stock_selector.py`脚本验证，选股器能够成功：

- 加载20条A股股票数据
- 执行选股算法并选出合适的股票
- 正确显示中文股票名称和行业信息

### 后续建议

1. **数据完整性提升**：
   - 当前A股数据中缺少一些重要财务指标（如PE、ROE等）
   - 建议补充完整的A股基本面数据，提高选股准确性

2. **过滤规则优化**：
   - 根据实际需求，可以进一步调整`filter_a_stocks.py`中的过滤规则
   - 例如添加更多行业分类、市值范围等筛选条件

3. **定期数据更新**：
   - 建议定期运行数据处理和过滤脚本，保持数据的时效性
   - 可以创建批处理文件，一键完成从原始数据到A股数据的处理流程

4. **选股算法改进**：
   - 基于纯粹的A股数据，可以进一步优化选股算法
   - 考虑添加行业轮动、技术指标等更多选股维度

### 文件位置

- 过滤工具：`filter_a_stocks.py`
- 编码修复工具：`fix_encoding.py`（支持A股和通用数据）
- 过滤后的A股数据：`data/processed/stock_data_a_shares_fixed.json`
- 过滤报告：`data/processed/stock_data_a_shares_filter_report_fixed.txt`
- 更新后的选股器：`backend/select_stock.py`

## A股数据清理和目录优化报告

### 执行时间
`2025-09-23`

### 任务概述
本次操作完成了以下任务：
1. 清理与A股无关的数据文件
2. 优化项目目录结构，使数据组织更加清晰合理
3. 验证清理和优化结果

### 清理成果

#### 1. Processed目录清理
- **删除了6个非必要文件**：
  - stock_data.json
  - stock_data_a_shares.json
  - stock_data_a_shares_filter_report.txt
  - stock_data_fixed.json
  - stock_data_fixed_log.txt
  - stock_data_log.txt
- **保留了2个关键A股数据文件**：
  - stock_data_a_shares_fixed.json (0.01 MB) - 修复编码后的A股数据
  - stock_data_a_shares_filter_report_fixed.txt (0.00 MB) - 修复编码后的过滤报告

#### 2. 免费股票数据清理
- **已删除**：free_stock_data.json

#### 3. 原始数据分类
- **处理了8737个.day文件**，按照A股和非A股进行了分类：
  - **A股文件**：3965个，存储在 `data/original/a_stock_lday/`
  - **非A股文件**：4772个，存储在 `data/original/non_a_stock_lday/`
- **删除了旧的lday目录**，实现了更合理的文件组织

### 优化后的目录结构

```
选股器/
├── data/                      # 数据目录
│   ├── daily/                 # 特定股票的日线数据（包含10个文件）
│   ├── original/              # 原始数据
│   │   ├── a_stock_lday/      # A股原始.day文件（3965个）
│   │   └── non_a_stock_lday/  # 非A股原始.day文件（4772个）
│   └── processed/             # 处理后的数据
│       ├── stock_data_a_shares_fixed.json            # 修复编码后的A股数据
│       └── stock_data_a_shares_filter_report_fixed.txt  # 修复编码后的过滤报告
├── backend/                   # 后端处理脚本
├── cleanup_a_stock_data.py    # 数据清理工具脚本
└── verify_cleanup.py          # 清理验证工具脚本
```

### 验证结果
所有验证项均已通过：
- ✅ processed目录只包含预期的A股相关文件
- ✅ original目录已成功优化，创建了A股和非A股子目录
- ✅ 免费股票数据文件已删除
- ✅ daily目录保持完整

### 后续建议
1. **定期更新A股数据**：运行filter_a_stocks.py来更新A股数据
2. **释放存储空间**：根据实际需要，可以删除non_a_stock_lday目录以释放空间
3. **数据备份**：建议备份重要数据后再进行任何重大操作
4. **功能验证**：运行选股器前，确保A股数据文件完整且格式正确

### 工具脚本说明

#### cleanup_a_stock_data.py
A股数据清理工具，支持自动确认模式：
```bash
python backend/data_processing/cleanup_a_stock_data.py --auto-confirm  # 自动确认所有操作
```

#### verify_cleanup.py
清理结果验证工具，用于检查数据清理和目录优化是否成功：
```bash
python scripts/verify_cleanup.py
```

---
**报告生成时间**: `2025-09-23`

## Vercel 自动部署说明

本项目已配置GitHub Actions自动部署到Vercel平台。以下是配置步骤说明：

### 1. 配置GitHub Secrets

在GitHub仓库的「Settings > Secrets > Actions」页面添加以下secrets：

- **VERCEL_TOKEN**：Vercel的API令牌
  - 如何获取：登录Vercel，访问「Account Settings > Tokens」创建新令牌

- **VERCEL_ORG_ID**：Vercel组织ID
  - 如何获取：登录Vercel，访问「Team Settings > General > Team ID」

- **VERCEL_PROJECT_ID**：Vercel项目ID
  - 如何获取：登录Vercel，选择您的项目，访问「Settings > General > Project ID」

### 2. 项目结构优化

GitHub Actions工作流配置了**sparse-checkout**，只会检出必要的前端文件进行部署，这样可以：
- 减少部署时上传的文件数量
- 避免触发Vercel免费版的文件上传请求限制
- 同时保持所有文件都保留在GitHub仓库中

部署时会使用的文件包括：
- `src/index.html`：主页面
- `src/stock_selector.js`：选股器逻辑
- `src/tushare_api.js`：API交互逻辑
- `vercel.json`：Vercel配置文件
- `.gitignore`：Git忽略配置文件

### 3. 部署流程

当代码推送到`main`分支时，GitHub Actions会自动：
1. 检出项目的必要文件（使用sparse-checkout减少文件数量）
2. 安装Vercel CLI
3. 设置Vercel环境变量
4. 部署到Vercel预览环境（使用命令行参数指定组织和项目）
5. 部署到Vercel生产环境（使用命令行参数指定组织和项目）

### 4. 手动部署（可选）

如果需要手动部署，可以使用以下命令：

```bash
# 部署到预览环境
vercel --yes --token YOUR_VERCEL_TOKEN --org YOUR_VERCEL_ORG_ID --project YOUR_VERCEL_PROJECT_ID

# 部署到生产环境
vercel --prod --yes --token YOUR_VERCEL_TOKEN --org YOUR_VERCEL_ORG_ID --project YOUR_VERCEL_PROJECT_ID
```

请将命令中的`YOUR_VERCEL_TOKEN`、`YOUR_VERCEL_ORG_ID`和`YOUR_VERCEL_PROJECT_ID`替换为您实际的Vercel凭据。

### 5. 注意事项

- 确保您的Vercel账户有足够的部署配额
- 如果遇到部署错误，请检查GitHub Actions的运行日志
- 如需修改部署配置，可以编辑`.github/workflows/vercel-deploy.yml`文件

### 6. 故障排除

#### 常见错误："您无权访问指定的帐户"或"--token"缺少值

如果遇到类似错误，请确保：
1. 已正确在GitHub Secrets中配置了`VERCEL_TOKEN`、`VERCEL_ORG_ID`和`VERCEL_PROJECT_ID`
2. 确保token具有足够的权限访问指定的组织和项目
3. 检查Vercel账户中是否确实存在该组织和项目

#### 权限问题

根据Vercel官方文档，如果遇到`scope-not-accessible`错误，通常是因为：
- 提供的token没有足够的权限访问指定的组织或项目
- 组织或项目ID不正确
- token已过期或被撤销

#### 工作流配置

工作流已优化为：
1. 通过环境变量设置`VERCEL_TOKEN`
2. 在部署命令中使用`--org`和`--project`参数明确指定组织和项目
3. 自动禁用遥测数据收集以避免相关问题

这种配置方式可以解决大多数权限和参数解析问题。

## Tushare API 选股器集成方案

本方案提供了完整的Tushare API集成工具，帮助选股器获取和处理真实的股票数据。

### 已创建的文件

1. **tushare_basic_data.py** - Tushare零积分接口数据获取脚本
2. **process_tushare_data.py** - 数据处理脚本，将Tushare数据转换为选股器格式
3. **tushare_integration.py** - 完整版Tushare API集成脚本（需要较高积分权限）
4. **tushare_api.js** - 前端JavaScript库，用于在选股器页面集成Tushare API功能

### 使用说明

#### 基础使用方法（零积分接口）

1. **获取基础股票数据**
   ```bash
   python tushare_basic_data.py
   ```
   - 此脚本使用Tushare的零积分接口获取基础股票数据
   - 每天限制获取10-20只股票的数据，避免触发调用频率限制
   - 已获取的数据会保存在`data`目录下，下次运行时不会重复获取

2. **处理数据并生成stock_data.json**
   ```bash
   python scripts/process_tushare_data.py
   ```
   - 此脚本将获取的基础数据转换为选股器需要的格式
   - 生成的`stock_data.json`文件可直接被选股器使用

#### 完整功能（需要较高积分权限）

```bash
python tushare_integration.py
```
- 此脚本使用Tushare的更多接口获取完整的股票数据
- 包含基本面指标、财务数据等更多信息
- 但需要较高的Tushare积分权限

### 数据特点

#### 通过零积分接口获取的数据包含：
- 股票代码、名称
- 最新价格
- 涨跌幅
- 成交量
- 行业信息（已部分补充）

#### 受限字段（需要积分权限）：
- 市盈率(PE)
- 净资产收益率(ROE)
- 换手率
- 市净率(PB)
- 成交额
- 市值

### 使用建议

1. **每日数据更新**
   - 建议每天只运行一次`python scripts/tushare_basic_data.py`
   - 每次运行可获取10-20只股票的最新数据
   - 运行后需要运行`python scripts/process_tushare_data.py`来更新选股器数据

2. **避开调用频率限制**
   - Tushare API有严格的调用频率限制，请勿频繁运行脚本
   - 免费用户限制：每分钟最多访问接口50次，每小时最多访问接口1次
   - 建议每天获取少量股票，逐步积累数据

3. **数据存储**
   - 股票列表保存在`data/stock_list.csv`
   - 日线数据保存在`data/daily/`目录下
   - 转换后的选股器数据保存在`stock_data.json`

4. **前端集成**
   - `tushare_api.js`已集成到`index.html`中
   - 选股器页面现在可以优先从API加载数据
   - 添加了股票搜索功能，可快速查找特定股票

### 注意事项

1. 本方案使用的Tushare token为：`e4f693ec67d80ef11b6fd446007110cd95bbf82508b7a7758e4f6fad`
2. 请不要将此token分享给他人，避免超出调用限制
3. 如果需要获取更多字段或更频繁的数据更新，建议升级Tushare账户获取更高权限
4. 脚本中包含错误处理和默认数据，确保在API调用受限的情况下也能正常运行

### 常见问题解决

1. **API调用失败**
   - 错误信息："抱歉，您每分钟最多访问该接口50次"
   - 解决方法：等待一分钟后再运行脚本，或减少每次获取的股票数量

2. **数据文件不存在**
   - 错误信息："No such file or directory: 'data/stock_list.csv'"
   - 解决方法：先运行`python scripts/tushare_basic_data.py`创建数据文件

3. **无法获取完整字段**
   - 问题：部分字段显示为0.0
   - 解决方法：这些字段需要更高的Tushare积分权限，目前使用默认值

## 当前项目状态

### 核心功能

1. **数据处理**
   - 支持解析通达信.day格式文件
   - 支持从Tushare API获取数据
   - 支持从免费数据源抓取数据
   - 支持数据清洗、整合和编码修复

2. **选股功能**
   - 实现了基于短期上涨潜力的选股算法
   - 支持A股数据过滤
   - 提供了命令行和浏览器界面两种使用方式

3. **界面展示**
   - 实现了现代化的前端界面
   - 支持粒子动画效果
   - 支持响应式布局

### 文件结构优化建议

基于对项目文件的分析，提出以下结构优化建议：

1. **数据处理模块整合**
   - 合并重复的数据解析脚本
   - 统一数据处理流程
   - 优化数据存储结构

2. **文档整合**
   - 合并重复的说明文档
   - 统一文档格式和内容
   - 创建完整的使用手册

3. **脚本清理**
   - 删除功能重复的脚本
   - 修复错误的脚本
   - 优化启动脚本

## 维护建议

1. **定期数据更新**
   - 建议每周更新一次股票数据
   - 使用`update_stock_data.bat`批处理文件自动化更新过程

2. **代码维护**
   - 定期检查依赖库版本
   - 优化数据处理算法
   - 修复可能出现的编码问题

3. **功能扩展**
   - 考虑添加更多选股策略
   - 支持更多数据源
   - 增强数据可视化功能

## 历史问题记录

### 已解决问题

1. **数据编码问题**
   - 在Windows环境下，中文显示出现乱码
   - 解决方案：使用`fix_encoding.py`修复编码（已合并原`fix_a_shares_encoding.py`功能）

2. **数据格式不统一**
   - 不同数据源的数据格式存在差异
   - 解决方案：开发了数据整合脚本统一格式

3. **选股算法优化**
   - 初始版本的选股逻辑较为简单
   - 解决方案：不断优化多因子选股算法

4. **A股数据过滤**
   - 原始数据包含大量非A股股票
   - 解决方案：开发了`filter_a_stocks.py`专门过滤A股股票

### 最近修复问题（2023-12）

#### Vercel部署问题修复

1. **问题：Vercel CLI不支持--org选项**
   - 错误信息：unknown or unexpected option: --org
   - 解决方案：从vercel-deploy.yml文件中移除了Vercel命令的--org选项
   - 影响：解决了Vercel CLI 48.1.1版本不支持--org选项导致的部署失败

2. **问题：Vercel CLI不支持--project选项**
   - 错误信息：unknown or unexpected option: --project
   - 解决方案：从vercel-deploy.yml文件的两个Vercel命令中移除了不被Vercel CLI 48.1.3版本支持的--project选项
   - 影响：解决了"unknown or unexpected option: --project"错误

3. **问题：Vercel令牌无效**
   - 错误信息：The specified token is not valid
   - 解决方案：确认vercel-deploy.yml文件已正确引用VERCEL_TOKEN密钥，建议用户更新GitHub仓库的VERCEL_TOKEN密钥
   - 影响：解决了令牌验证失败导致的部署问题

4. **问题：Vercel CLI版本兼容性问题**
   - 解决方案：重构了Vercel部署流程，将部署方式从CLI命令改为使用部署挂钩URL触发
   - 具体变更：
     - 移除了Vercel CLI安装和环境变量设置步骤
     - 添加了通过curl命令POST到Vercel部署挂钩URL的步骤
     - 添加了工作流手动触发选项
     - 增加了部署文件验证步骤
   - 影响：避免了CLI版本兼容性问题，提高了部署稳定性

#### 前端文件引用问题修复

1. **问题：index.html中的JS文件引用路径不正确**
   - 错误提示：check_structure.py检测到index.html未正确引用js/tushare_api.js或js/stock_selector.js
   - 解决方案：在index.html文件中添加了head标签，并在其中正确引用了js/tushare_api.js和js/stock_selector.js文件
   - 影响：解决了项目结构检查失败的问题，确保前端JS文件能够正确加载

## 版本记录

| 版本号 | 更新日期 | 更新内容 | 负责人 |
|-----|------|------|-----|
| 0.1 | 初始开发 | 基础框架搭建 | - |
| 0.2 | - | 数据处理功能实现 | - |
| 0.3 | - | 选股算法优化 | - |
| 0.4 | - | A股数据过滤功能添加 | - |
| 0.5 | 当前版本 | 编码问题修复，功能完善 | - |
| 0.6 | 当前版本 | 目录结构优化 | - |

## 结构优化记录

在版本0.6中，对项目结构进行了全面优化，主要变更如下：

1. **后端脚本按功能拆分**
   - 创建`data_processing/`目录：存放数据处理相关脚本（parse_day_files.py, cleanup_a_stock_data.py, integrate_stock_data.py）
   - 创建`filtering/`目录：存放股票筛选相关脚本（select_stock.py, filter_a_stocks.py）
   - 创建`api/`目录：存放API相关脚本（free_stock_data.py）
   - 创建`tests/`目录：存放测试脚本（test_stock_selection.py）

2. **前端资源隔离**
   - 创建`js/`目录：存放JavaScript文件（stock_selector.js, tushare_api.js）
   - 创建`css/`目录：存放CSS样式文件
   - 调整前端资源目录结构

3. **文档、日志和工具脚本分离**
   - 创建`docs/`目录：存放所有项目文档
   - 创建`logs/`目录：存放日志文件
   - 创建`scripts/`目录：存放工具脚本
   - 创建`config/`目录：存放配置文件

4. **文件冗余清理**
   - 清理重复和无用的文件
   - 优化.gitignore文件，确保临时文件不被提交

---

**生成时间**: 2025-09-24