# 选股器项目开发维护日志

## 项目概述

本项目是一个基于多因子模型的量化选股工具，支持股票数据分析、筛选和可视化展示。项目提供了前端界面和后端脚本两种使用方式，能够从多种数据源获取和处理股票数据。

## 开发历程

### 初始开发阶段

1. **项目架构设计**
   - 设计了前端（HTML/CSS/JavaScript）和后端（Python）分离的架构
   - 创建了模块化的数据处理和选股逻辑
   - 设计了数据存储结构（原始数据和处理后数据分离）

2. **核心功能实现**
   - 开发了通达信.day文件解析功能（`parse_day_files.py`）
   - 实现了多因子选股算法（`select_stock.py`）
   - 构建了前端可视化界面（`index.html`, `stock_selector.js`）

### 数据集成阶段

1. **数据源扩展**
   - 集成了Tushare API数据源（`tushare_integration.py`）
   - 开发了免费数据源爬虫（`free_stock_data.py`）
   - 实现了数据整合功能（`integrate_stock_data.py`, `process_tushare_data.py`）

2. **数据处理优化**
   - 开发了多个数据解析脚本（`parse_stock_data.py`, `parse_all_data.py`）
   - 实现了数据编码修复功能（`fix_encoding.py`, `count_stocks.py`）

### 功能完善阶段

1. **A股数据过滤**
   - 开发了A股数据过滤工具（`filter_a_stocks.py`）
   - 实现了A股数据编码修复功能（`fix_encoding.py`）
   - 创建了A股数据过滤说明文档

2. **用户体验优化**
   - 开发了简化的运行入口（`run_stock_selector.py`）
   - 实现了测试脚本（`test_stock_selection.py`）
   - 创建了详细的使用文档（`README.md`, `启动指南.md`）

## 当前项目状态

### 核心功能

1. **数据处理**
   - 支持解析通达信.day格式文件
   - 支持从Tushare API获取数据
   - 支持从免费数据源抓取数据
   - 支持数据清洗、整合和编码修复

2. **选股功能**
   - 实现了基于短期上涨潜力的选股算法
   - 支持A股数据过滤
   - 提供了命令行和浏览器界面两种使用方式

3. **界面展示**
   - 实现了现代化的前端界面
   - 支持粒子动画效果
   - 支持响应式布局

### 文件结构优化建议

基于对项目文件的分析，提出以下结构优化建议：

1. **数据处理模块整合**
   - 合并重复的数据解析脚本
   - 统一数据处理流程
   - 优化数据存储结构

2. **文档整合**
   - 合并重复的说明文档
   - 统一文档格式和内容
   - 创建完整的使用手册

3. **脚本清理**
   - 删除功能重复的脚本
   - 修复错误的脚本
   - 优化启动脚本

## 维护建议

1. **定期数据更新**
   - 建议每周更新一次股票数据
   - 使用`update_stock_data.bat`批处理文件自动化更新过程

2. **代码维护**
   - 定期检查依赖库版本
   - 优化数据处理算法
   - 修复可能出现的编码问题

3. **功能扩展**
   - 考虑添加更多选股策略
   - 支持更多数据源
   - 增强数据可视化功能

## 历史问题记录

1. **数据编码问题**
   - 在Windows环境下，中文显示出现乱码
   - 解决方案：使用`fix_encoding.py`修复编码（已合并原`fix_a_shares_encoding.py`功能）

2. **数据格式不统一**
   - 不同数据源的数据格式存在差异
   - 解决方案：开发了数据整合脚本统一格式

3. **选股算法优化**
   - 初始版本的选股逻辑较为简单
   - 解决方案：不断优化多因子选股算法

4. **A股数据过滤**
   - 原始数据包含大量非A股股票
   - 解决方案：开发了`filter_a_stocks.py`专门过滤A股股票

## 版本记录

| 版本号 | 更新日期 | 更新内容 | 负责人 |
|-----|------|------|-----|
| 0.1 | 初始开发 | 基础框架搭建 | - |
| 0.2 | - | 数据处理功能实现 | - |
| 0.3 | - | 选股算法优化 | - |
| 0.4 | - | A股数据过滤功能添加 | - |
| 0.5 | 当前版本 | 编码问题修复，功能完善 | - |
| 0.6 | 当前版本 | 目录结构优化 | - |

## 结构优化记录

在版本0.6中，对项目结构进行了全面优化，主要变更如下：

1. **后端脚本按功能拆分**
   - 创建`data_processing/`目录：存放数据处理相关脚本（parse_day_files.py, cleanup_a_stock_data.py, integrate_stock_data.py）
   - 创建`filtering/`目录：存放股票筛选相关脚本（select_stock.py, filter_a_stocks.py）
   - 创建`api/`目录：存放API相关脚本（free_stock_data.py）
   - 创建`tests/`目录：存放测试脚本（test_stock_selection.py）

2. **前端资源隔离**
   - 创建`js/`目录：存放JavaScript文件（stock_selector.js, tushare_api.js）
   - 创建`css/`目录：存放CSS样式文件
   - 调整前端资源目录结构

3. **文档、日志和工具脚本分离**
   - 创建`docs/`目录：存放所有项目文档
   - 创建`logs/`目录：存放日志文件
   - 创建`scripts/`目录：存放工具脚本
   - 创建`config/`目录：存放配置文件

4. **文件冗余清理**
   - 清理重复和无用的文件
   - 优化.gitignore文件，确保临时文件不被提交

## 最新问题解决方案

### 2023-12 Vercel部署问题修复

1. **问题：Vercel CLI不支持--org选项**
   - 错误信息：unknown or unexpected option: --org
   - 解决方案：从vercel-deploy.yml文件中移除了Vercel命令的--org选项
   - 影响：解决了Vercel CLI 48.1.1版本不支持--org选项导致的部署失败

2. **问题：Vercel CLI不支持--project选项**
   - 错误信息：unknown or unexpected option: --project
   - 解决方案：从vercel-deploy.yml文件的两个Vercel命令中移除了不被Vercel CLI 48.1.3版本支持的--project选项
   - 影响：解决了"unknown or unexpected option: --project"错误

3. **问题：Vercel令牌无效**
   - 错误信息：The specified token is not valid
   - 解决方案：确认vercel-deploy.yml文件已正确引用VERCEL_TOKEN密钥，建议用户更新GitHub仓库的VERCEL_TOKEN密钥
   - 影响：解决了令牌验证失败导致的部署问题

4. **问题：Vercel CLI版本兼容性问题**
   - 解决方案：重构了Vercel部署流程，将部署方式从CLI命令改为使用部署挂钩URL触发
   - 具体变更：
     - 移除了Vercel CLI安装和环境变量设置步骤
     - 添加了通过curl命令POST到Vercel部署挂钩URL的步骤
     - 添加了工作流手动触发选项
     - 增加了部署文件验证步骤
   - 影响：避免了CLI版本兼容性问题，提高了部署稳定性

### 2023-12 前端文件引用问题修复

1. **问题：index.html中的JS文件引用路径不正确**
   - 错误提示：check_structure.py检测到index.html未正确引用js/tushare_api.js或js/stock_selector.js
   - 解决方案：在index.html文件中添加了head标签，并在其中正确引用了js/tushare_api.js和js/stock_selector.js文件
   - 影响：解决了项目结构检查失败的问题，确保前端JS文件能够正确加载